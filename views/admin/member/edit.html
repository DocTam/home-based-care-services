<?php include(VIEWS.'/common/header.html'); ?>
    <script type="text/javascript">
	$(document).ready(function(e) {
         
		$("select").uedSelect({
          width: 100
        });

		$("#select_vip").uedSelect({
          width: 100
        });

		$("#select_sex").uedSelect({
          width: 100
        });

		 
      });</script>
 
      <div class="place">
        <span>位置：</span>
        <ul class="placeul">
          <li>
            <a href="admin.php?c=index&a=right">首页</a></li>
			<li><a href="admin.php?c=member">会员信息管理</a></li>
			<li><?php if($id>0){echo '编辑';}else{echo '添加';}?></li>
		  <?php if($frompage){?>
		  <li><a href="<?php echo $frompage; ?>">返回</a></li>
		  <?php }?>
        </ul>
      </div>
	  <form >
      <div class="formbody">
        <div class="formtitle">
          <span>个人信息</span></div>
        <ul class="forminfo">
          <table>
            <tr>
              <td>
                <li>
                  <label>真实姓名:</label>
                  <input name="name" type="text" value="<?php echo $info['name'];?>" id="name" class="dfinput" />
				  <i><b>*</b></i>
				</li>
              </td>
              <td>
                <li>
                  <label>会员编号:</label>
				  <?php if($id>0){?>
                  <input  type="text" disabled value="<?php echo $info['member_no'];?>" id="member_no" class="dfinput" />
					<?php }else{?>
				  <input  type="text"  class="dfinput" disabled value="<?php echo $code;?>" />
				  <?php }?>
				  <i><b>*</b></i>
				 </li>
              </td>
              <td>
                <li>
                  <label>是否会员:</label>
                  <div class="vocation">
                    <select id="select_vip" name="select_vip" onchange="vipChange(this)">
                      <option value="">请选择</option>
                      <option value="1" <?php if($info['select_vip'] == 1){echo 'selected';}?>>是</option>
                      <option value="2" <?php if($info['select_vip'] == 2){echo 'selected';}?>>否</option></select>
                  </div>
                </li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>性别:</label>
                  <div class="vocation">
                    <select name="select_sex" id="select_sex">
                      <option value="">请选择</option>
                      <option value="1" <?php if($info['select_sex'] == 1){echo 'selected';}?>>男</option>
                      <option value="2" <?php if($info['select_sex'] == 2){echo 'selected';}?>>女</option>
					</select>
                  </div>
                </li>
              </td>
              <td>
                <li>
                  <label>出生年月:</label>
                  <input name="birthday" onClick="WdatePicker({ dateFmt: 'yyyy/MM', onpicked: function() { $(this).trigger('change') }, oncleared: function() { $(this).trigger('change') } })" type="text" value="<?php echo $info['birthY']>0 ? ($info['birthY'] . '/' . $info['birthM']) : ''; ?>" id="birthday" class="dfinput" />
				  </li>
              </td>
              <td>
                <li>
                  <label>血型:</label>
                  <div class="vocation">
                    <select id="select_bloodType" name="select_bloodType">
                      <option value="">请选择</option>
                      <option value="A" <?php if($info['select_bloodType'] == 'A'){echo 'selected';}?>>A型</option>
                      <option value="B" <?php if($info['select_bloodType'] == 'B'){echo 'selected';}?>>B型</option>
                      <option value="O" <?php if($info['select_bloodType'] == 'O'){echo 'selected';}?>>O型</option>
                      <option value="AB" <?php if($info['select_bloodType'] == 'AB'){echo 'selected';}?>>AB型</option>
					  <option value="其它" <?php if($info['select_bloodType'] == '其它'){echo 'selected';}?>>其它型</option>
					  </select>
                  </div>
                </li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>籍贯:</label>
                  <input name="birthplace" value="<?php echo $info['birthplace'];?>" type="text" id="birthplace" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>学历:</label>
                  <input name="educational"  value="<?php echo $info['educational'];?>" type="text" id="educational" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>身份证号:</label>
                  <input name="idcard" value="<?php echo $info['idcard'];?>" type="text" id="idcard" class="dfinput" /></li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>岗位职称:</label>
                  <input name="technicaltitle" value="<?php echo $info['technicaltitle'];?>" type="text" id="technicaltitle" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>民族:</label>
                  <input name="nation" value="<?php echo $info['nation'];?>" type="text" id="nation" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>身高:</label>
                  <input name="height" value="<?php echo $info['height'];?>" type="text" id="height" class="dfinput" /></li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>健康状况:</label>
                  <input name="health" value="<?php echo $info['health'];?>" type="text" id="health" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>政治面貌:</label>
                  <input name="political" value="<?php echo $info['political'];?>" type="text" id="political" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>所在行业:</label>
                  <input name="industry" value="<?php echo $info['industry'];?>" type="text" id="industry" class="dfinput" /></li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>介绍人:</label>
                  <input name="introducer" value="<?php echo $info['introducer'];?>" type="text" id="introducer" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>婚姻:</label>
                  <div class="vocation">
                    <select id="select_marriage" name="select_marriage">
					  <option value="">请选择</option>
                      <option value="1" <?php if($info['select_marriage'] == 1){echo 'selected';}?>>已婚</option>
                      <option value="2" <?php if($info['select_marriage'] == 2){echo 'selected';}?>>未婚</option></select>
                  </div>
                </li>
              </td>
              <td>
                <li>
                  <label>联系电话:</label>
                  <input name="contactphone" value="<?php echo $info['contactphone'];?>" type="text" id="contactphone" class="dfinput" /></li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>手机号码:</label>
                  <input name="mobile" value="<?php echo $info['mobile'];?>" type="text" id="mobile" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>家庭地址:</label>
                  <input name="address" value="<?php echo $info['address'];?>" type="text" id="address" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>工作地址:</label>
                  <input name="workaddress" value="<?php echo $info['workaddress'];?>" type="text" id="workaddress" class="dfinput" /></li>
              </td>
            </tr>
             
          </table>
        </ul>
      </div>
      <div class="formbody" id="vip_info" style="<?php if($info['select_vip']!=1){?>display:none;<?php }?>">
        <div class="formtitle">
          <span>会员信息</span></div>
        <ul class="forminfo">
          <table>
            <tr>
              <td>
                <li>
                  <label>入会时间:</label>
                  <input name="vip_time" onClick="WdatePicker({ dateFmt: 'yyyy-MM-dd', onpicked: function() { $(this).trigger('change') }, oncleared: function() { $(this).trigger('change') } })" type="text"  id="vip_time" class="dfinput" value="<?php echo $info['vip_time']>0? date('Y-m-d',$info['vip_time']) : '';?>" /></li>
              </td>
              <td>
                <li>
                  <label>会员到期时间:</label>
                  <input name="vip_end" onClick="WdatePicker({ dateFmt: 'yyyy-MM-dd', onpicked: function() { $(this).trigger('change') }, oncleared: function() { $(this).trigger('change') } })" type="text"  id="vip_end" class="dfinput" value="<?php echo $info['vip_end']>0? date('Y-m-d',$info['vip_end']) : '';?>" /></li>
              </td>
              <td>
                <li>
                  <label>会员等级:</label>
                  <div class="vocation">
                    <select id="vip_level" name="vip_level">
                      <option value="">请选择</option>
                      <option value="1" <?php if($info['vip_level'] == 1){echo 'selected';}?>>一级</option>
                      <option value="2" <?php if($info['vip_level'] == 2){echo 'selected';}?>>二级</option>
                      <option value="3" <?php if($info['vip_level'] == 3){echo 'selected';}?>>三级</option>
                      <option value="4" <?php if($info['vip_level'] == 4){echo 'selected';}?>>四级</option></select>
                  </div>
                </li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>会员金额:</label>
                  <input name="vip_amount" value="<?php echo $info['vip_amount'];?>" type="text" id="vip_amount" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>会员状态:</label>
                  <div class="vocation">
                    <select name="vip_status" id="vip_status">
                      <option value="">请选择</option>
                      <option value="1" <?php if($info['vip_status'] == 1){echo 'selected';}?>>有效</option>
                      <option value="2" <?php if($info['vip_status'] == 2){echo 'selected';}?>>无效</option></select>
                  </div>
                </li>
              </td>
              <td>
                <li>
                  <label>录入时间:</label>
                  <input name="vip_addtime" onClick="WdatePicker({ dateFmt: 'yyyy-MM-dd', onpicked: function() { $(this).trigger('change') }, oncleared: function() { $(this).trigger('change') } })" type="text" id="vip_addtime" class="dfinput" value="<?php echo $info['vip_addtime']>0? date('Y-m-d',$info['vip_addtime']) : '';?>" /></li>
              </td>
            </tr>
          </table>
        </ul>
      </div>
      <div class="formbody">
        <div class="formtitle">
          <span>家庭背景</span></div>
        <ul class="forminfo">
          <table>
            <tr>
              <td>
                <li>
                  <label>家庭人数:</label>
                  <input name="familynum" value="<?php echo $info['familynum'];?>" type="text" id="familynum" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>家庭称谓:</label>
                  <input name="familyname" value="<?php echo $info['familyname'];?>" type="text" id="familyname" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>家庭面积:</label>
                  <input name="familyarea" value="<?php echo $info['familyarea'];?>" type="text" id="familyarea" class="dfinput" /></li>
              </td>
            </tr>
            <tr>
              <td>
                <li>
                  <label>公交路线:</label>
                  <input name="busroad" value="<?php echo $info['busroad'];?>" type="text" id="busroad" class="dfinput" /></li>
              </td>
              <td></td>
              <td></td>
            </tr>
          </table>
        </ul>
      </div>
      <div class="formbody">
        <div class="formtitle">
          <span>其它联系人、监护人
			&nbsp;&nbsp;&nbsp;<a href="javascript: addother();;" id="" style="color:blue;">增加</a>
		  </span>
		</div>
        <ul class="forminfo" id="other_forminfo">
		<?php 
			if(empty($info['otherdata'])){
				$info['otherdata'] = array([ array('other_contact' => '')]);//至少有1个数据
			}
			$datalen = count($info['otherdata']);
			foreach($info['otherdata'] as $key => $other ){
		?>
		<div id="other_tmpl" class="otherinfo">
          <table>
            <tr>
              <td>
                <li>
                  <label>姓名:</label>
                  <input name="other_contact" value="<?php echo $other['other_contact'];?>" type="text" id="other_contact" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  
				  <label>性别:</label>
                  <div class="vocation">
                    <select name="other_contact_gender" id="other_contact_gender">
                      <option selected="selected" value="">请选择</option>
                <option value="1" <?php if($other['other_contact_gender'] == 1){echo 'selected';}?>>男</option>
                <option value="2" <?php if($other['other_contact_gender'] == 2){echo 'selected';}?>>女</option></select>
                  </div>
				  </li>
              </td>
              <td>
                <li>
                  <label>家庭人数:</label>
                  <input name="other_familynum" value="<?php echo $other['other_familynum'];?>" type="text" id="other_familynum" class="dfinput" /></li>
              </td>

			  <td>
				&nbsp;&nbsp;&nbsp;<a href="javascript: ;" onclick="delother(this)" style="color:blue;">删除</a>
			  </td>

            </tr>
            <tr>
              <td>
                <li>
                  <label>家庭称谓:</label>
                  <input name="other_familyname" value="<?php echo $other['other_familyname'];?>" type="text" id="other_familyname" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>身份证号码:</label>
                  <input name="other_idcard" value="<?php echo $other['other_idcard'];?>" type="text" id="other_idcard" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>所属部门:</label>
                  <input name="other_department" value="<?php echo $other['other_department'];?>" type="text" id="other_department" class="dfinput" /></li>
              </td>
			  <td></td>
            </tr>
            <tr>
               
              <td>
                <li>
                  <label>固定电话:</label>
                  <input name="other_phone" value="<?php echo $other['other_phone'];?>" type="text" id="other_phone" class="dfinput" /></li>
              </td>
              <td>
                <li>
                  <label>移动电话:</label>
                  <input name="other_mobile" value="<?php echo $other['other_mobile'];?>" type="text" id="other_mobile" class="dfinput" /></li>
              </td>
			  <td>
				<li>
                  <label>关系:</label>
                  <input name="other_ship" value="<?php echo $other['other_ship'];?>" type="text" id="other_ship" class="dfinput" /></li>
			  </td>
			  <td></td>
            </tr>
             
          </table>
		  <?php 
			if($datalen>1){
		  ?>

		  <div style="border-bottom: solid 1px #F0DCBE;margin: 15px 15px;" id="other1"></div>

		  <?php }?>
		  </div>
		  <?php } ?>
 
        </ul>


      </div>
      <div class="formbody">
        <ul class="forminfo">
          <table width="0" border="0" align="center">
            <tr>
              <td>
                <li>
                  <label>&nbsp;</label>
                  <input name="" type="button" class="btn" value="确认保存" id="submit_btn" /></li>
              </td>
            </tr>
          </table>
        </ul>
      </div>
	  <input type="hidden" name="id" id="id" value="<?php echo $id;?>" /> 
	  </form>
<script>
function vipChange(obj){
	var isvip = $(obj).val();
	if(isvip == '1'){
		$("#vip_info").show();
	} else {
		$("#vip_info").hide();
	}
}

//var other_tmpl = $("#other_tmpl").html();
var other_tmpl = '<table><tbody><tr><td><li><label>姓名:</label><input name="other_contact" value="" type="text" id="other_contact" class="dfinput"></li></td><td><li><label>性别:</label><div class="vocation"><select name="other_contact_gender" id="other_contact_gender"><option value="">请选择</option><option value="1">男</option><option value="2">女</option></select></div></li></td><td><li><label>家庭人数:</label><input name="other_familynum" value="" type="text" id="other_familynum" class="dfinput"></li></td><td>&nbsp;&nbsp;&nbsp;<a href="javascript: ;" onclick="delother(this)" style="color:blue;">删除</a></td></tr><tr><td><li><label>家庭称谓:</label><input name="other_familyname" value="" type="text" id="other_familyname" class="dfinput"></li></td><td><li><label>身份证号码:</label><input name="other_idcard" value="" type="text" id="other_idcard" class="dfinput"></li></td><td><li><label>所属部门:</label><input name="other_department" value="" type="text" id="other_department" class="dfinput"></li></td><td></td></tr><tr><td><li><label>固定电话:</label><input name="other_phone" value="" type="text" id="other_phone" class="dfinput"></li></td><td><li><label>移动电话:</label><input name="other_mobile" value="" type="text" id="other_mobile" class="dfinput"></li></td><td><li><label>关系:</label><input name="other_ship" value="" type="text" id="other_ship" class="dfinput"></li></td><td></td></tr></tbody></table>';
var line = '<div style="border-bottom: solid 1px #F0DCBE;margin: 15px 15px;" id="other1"></div>';

function addother(){
	if($(".otherinfo").length && $(".otherinfo").length >= 1){
		var html = '<div class="otherinfo">' + line + other_tmpl + '</div>';
	} else {
		var html = '<div class="otherinfo">' + other_tmpl + '</div>';
	}	
	$("#other_forminfo").append(html);
	$("select").uedSelect({
          width: 230
    });
}

function delother(obj){
	//if($(".otherinfo").length && $(".otherinfo").length > 1){
		$(obj).parents(".otherinfo").remove();
	//} else {
		//alert("不能全部删除!");
	//}
}
var frompage = '<?php echo $frompage;?>';
$("#submit_btn").click(function(){

	var t = $('form').serializeArray();
	var data = {};
	var other = {};
	$.each(t, function() {
		if( this.name.indexOf('other') > -1 ){
			if("undefined" === typeof other[this.name] ){
				other[this.name] = [];
			}
			other[this.name].push(this.value);			
		} else {
			data[this.name] = this.value;
		}
	});
	data['otherdata'] = other;

	if(!data['name'] || data['name'] == ''){
		alert("请填写真实姓名!");
		return;
	}

	jQuery.ajax({
			type: 'post',
			url: 'admin.php?c=member&a=save',
			data: data,
			dataType: 'json',
			cache: false,
			success: function(res){
				
				if(res.Success){
					alert('操作成功!');
					if(frompage && frompage.length>0){
						location.href = frompage;
						return;
					}
					location.href = 'admin.php?c=member&a=index';
				} else {
					alert(res.Msg);
				}
			}

		});
});

</script>
<?php include(VIEWS.'/common/footer.html'); ?>